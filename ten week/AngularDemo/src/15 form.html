<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <style>
        [ng-cloak] {
            display: none;
        }

        .my-form.ng-invalid {
            background-color: red;

        }
    </style>
</head>
<body ng-cloak>
<div ng-controller="firstCtrl" class="container">
    <form class="form-horizontal" name="myForm" style="margin-top: 100px" novalidate>
        <div class="form-group" ng-class="{'has-error':myForm.username.$dirty && myForm.username.$invalid}">
            <label class="col-sm-2 control-label">用户名</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" ng-required="true" placeholder="请输入密码" name="username"
                       autocomplete="off" ng-minlength="5" ng-maxlength="10" ng-pattern="/^[a-zA-Z]{1}/"
                       ng-model="data.username">
                <div class="alert alert-danger help-block" role="alert"
                     ng-show="myForm.username.$dirty && myForm.username.$error.minlength">
                    用户名不能少于5位数
                </div>
                <div class="alert alert-danger help-block" role="alert"
                     ng-show="myForm.username.$dirty && myForm.username.$error.maxlength">
                    用户名不能超过10位数
                </div>
                <div class="alert alert-danger help-block" role="alert"
                     ng-show="myForm.username.$dirty && myForm.username.$error.pattern">
                    用户名必须以字母开头
                </div>
            </div>
        </div>

        <!--密码-->

        <div class="form-group" ng-class="{'has-error':myForm.password.$dirty && myForm.password.$invalid}">
            <label class="col-sm-2 control-label">密码</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" placeholder="请输入密码" name="password"
                       autocomplete="off" ng-minlength="5" ng-maxlength="10"
                       ng-model="data.password">
                <div class="alert alert-danger help-block" role="alert"
                     ng-show="myForm.password.$dirty && myForm.password.$error.minlength && myForm.password.$dirty">
                    密码不能少于5位数
                </div>
                <div class="alert alert-danger help-block" role="alert"
                     ng-show="myForm.password.$dirty &&  myForm.password.$error.maxlength">
                    密码不能超过10位数
                </div>
            </div>
        </div>

        <!--确认密码：-->

        <div class="form-group"
             ng-class="{'has-error':myForm.passwordConfirm.$dirty && myForm.passwordConfirm.$invalid}">
            <label class="col-sm-2 control-label">确认密码</label>
            <div class="col-sm-10">
                <input type="password" autocomplete="off" name="passwordConfirm" ng-required="true"
                       ng-model="data.passwordConfirm" class="form-control" placeholder="确认密码">
                <div ng-show="myForm.passwordConfirm.$dirty && myForm.password.$dirty && myForm.passwordConfirm.$dirty && data.password !== data.passwordConfirm"
                     class="alert alert-danger help-block">
                    密码和确认密码不一致
                </div>
            </div>
        </div>


        <div class="form-group" ng-class="{'has-error':myForm.email.$dirty && myForm.email.$invalid}">
            <label class="col-sm-2 control-label">邮箱</label>
            <div class="col-sm-10">
                <input type="email" autocomplete="off" name="email" ng-required="true" ng-model="data.email"
                       class="form-control" placeholder="请输入邮箱" ng-minlength="5" ng-maxlength="30">
                <div ng-show="myForm.email.$dirty && myForm.email.$error.minlength"
                     class="alert alert-danger help-block">
                    邮箱的长度必须大于5
                </div>
                <div ng-show="myForm.email.$dirty &&  myForm.email.$error.maxlength"
                     class="alert alert-danger help-block">
                    邮箱的长度必须小于30
                </div>
                <div ng-show="myForm.email.$dirty &&  myForm.email.$error.email" class="alert alert-danger help-block">
                    邮箱格式不正确
                </div>
            </div>
        </div>

        <div class="form-group" ng-class="{'has-error':myForm.blog.$dirty && myForm.blog.$invalid}">
            <label class="col-sm-2 control-label">博客网址</label>
            <div class="col-sm-10">
                <input type="url" autocomplete="off" name="blog" ng-required="true" ng-model="data.blog"
                       class="form-control" placeholder="请输入博客网址">
                <div ng-show="myForm.email.$dirty &&  myForm.blog.$error.minlength"
                     class="alert alert-danger help-block">
                    博客网址的长度必须大于5
                </div>
                <div ng-show="myForm.email.$dirty &&  myForm.blog.$error.maxlength"
                     class="alert alert-danger help-block">
                    博客网址的长度必须小于30
                </div>
                <div ng-show="myForm.email.$dirty &&  myForm.blog.$error.url" class="alert alert-danger help-block">
                    博客网址格式不正确
                </div>
            </div>
        </div>


        <div class="form-group" ng-class="{'has-error':myForm.age.$dirty && myForm.age.$invalid}">
            <label class="col-sm-2 control-label">年龄</label>
            <div class="col-sm-10">
                <input type="number" autocomplete="off" name="age" ng-required="true" ng-model="data.age"
                       class="form-control" placeholder="年龄" min="10" max="100">
                <div ng-show="myForm.email.$dirty &&  myForm.age.$error.min" class="alert alert-danger help-block">
                    年龄必须大于10岁
                </div>
                <div ng-show="myForm.email.$dirty && myForm.age.$error.max" class="alert alert-danger help-block">
                    年龄必须小于100岁
                </div>
            </div>
        </div>


        <div class="form-group">
            <label class="col-sm-2 control-label">性别</label>
            <div class="col-sm-10">
                <label class="radio-inline">
                    <input type="radio" name="sex" value="1" ng-model="data.sex" ng-required="true"/>男
                </label>

                <label class="radio-inline">
                    <input type="radio" name="sex" value="0" ng-model="data.sex" ng-required="true"/>女
                </label>

            </div>
        </div>

        <!--复选框的按钮-->
        <div class="form-group">
            <label class="col-sm-2 control-label">爱好</label>
            <div class="col-sm-10">
                <label class="checkbox-inline" ng-repeat="hobby in hobbys">
                    <input type="checkbox" value="hobby.id"
                           ng-checked="data.hobbies===undefined?false:data.hobbies.indexOf(hobby.id)!==-1"
                           ng-click="toggleHobby(hobby.id)">{{hobby.name}}
                </label>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">出生地</label>
            <div class="col-sm-3">
                <select class="form-control" ng-model="data.province"
                        ng-options="x.id as x.name for x in cities | filterCity : 0"></select>
            </div>
            <div class="col-sm-3">
                <select class="form-control" ng-show="data.province" ng-model="data.area"
                        ng-options="x.id as x.name for x in cities | filterCity: data.province"></select>
            </div>
            <div class="col-sm-3">
                <select ng-required="true" class="form-control" ng-show="data.province && data.area"
                        ng-model="data.city"
                        ng-options="x.id as x.name for x in cities | filterCity : data.area"></select>
            </div>

        </div>


        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button class="btn btn-default"
                        ng-disabled="myForm.$invalid  || data.hobbies.length===0 || data.hobbies===undefined">注册
                </button>
                <button type="reset" class="btn btn-default" ng-click="reset()">重置</button>
            </div>
        </div>


    </form>

</div>
<script src="../node_modules/angular/angular.js"></script>
<script charset="utf-8" type="text/javascript">
    angular.module("myApp", [])
        .filter('filterCity', function () {
            return function (data, parent) {
                var objData = [];
                angular.forEach(data, function (obj) {
                    if (obj.parent == parent) {
                        objData.push(obj);
                    }
                });
                return objData;//返回的是过滤之后的数据
            }
        })
        .controller('firstCtrl', ['$scope', function ($scope) {
            var that = this;
            $scope.hobbys = [
                {
                    id: 1,
                    name: "写代码"
                },
                {
                    id: 2,
                    name: "睡懒觉"
                },
                {
                    id: 3,
                    name: "打豆豆"
                }
            ];

            $scope.data = {
                hobbies: [1, 2],
                city: 3
            };
            $scope.originData = angular.copy($scope.data);
            $scope.reset = function () {
                $scope.data = angular.copy($scope.originData);
                that.initCity();
                $scope.myForm.$setPristine();

            };
            $scope.cities = [
                {
                    name: '上海',
                    parent: 0,
                    id: 1
                },
                {
                    name: '上海市',
                    parent: 1,
                    id: 2
                },
                {
                    name: '徐汇区',
                    parent: 2,
                    id: 8
                },
                {
                    name: '长宁区',
                    parent: 2,
                    id: 3
                },
                {
                    name: '北京',
                    parent: 0,
                    id: 4
                },
                {
                    name: '北京市',
                    parent: 4,
                    id: 5
                },
                {
                    name: '东城区',
                    parent: 5,
                    id: 6
                },
                {
                    name: '丰台区',
                    parent: 5,
                    id: 7
                },
                {
                    name: '浙江',
                    parent: 0,
                    id: 9
                },
                {
                    name: '杭州',
                    parent: 9,
                    id: 100
                },
                {
                    name: '宁波',
                    parent: 9,
                    id: 11
                },
                {
                    name: '西湖区',
                    parent: 100,
                    id: 12
                },
                {
                    name: '北仑区‎',
                    parent: 11,
                    id: 13
                }
            ];

            this.findCityId = function (parent) {
                var parentId;
                angular.forEach($scope.cities, function (city) {
                    if (city.id === parent) {
                        parentId = city.parent;
                        return;
                    }
                });
                return parentId;
            };


            this.initCity = function () {
                if ($scope.data.city !== undefined) {
                    $scope.data.area = this.findCityId($scope.data.city);
                    console.log($scope.data.area);
                    $scope.data.province = this.findCityId($scope.data.area);

                }
            };
            this.initCity.call(this);


            $scope.toggleHobby = function (id) {
                var index = -1;
                if ($scope.data.hobbies === undefined) {
                    $scope.data.hobbies = [];
                } else {
                    index = $scope.data.hobbies.indexOf(id)
                }
                if (index === -1) {
                    //不存在的话追加
                    $scope.data.hobbies.push(id);
                } else {
                    $scope.data.hobbies.splice(index, 1);
                }

            }

        }]);

</script>

</body>
</html>
